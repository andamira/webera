#!/usr/bin/env bash


#-------------------------------------------------------------------------------
# ::main
#
webera::generate-examples::main() {

	local OPTION_LOG_LEVEL=0
	local OPTION_LOG_CLEAR=''
	local OPTION_LOAD_IN_WEB_BROWSER=false;

	local DIR
	DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
	local WEBERA="$DIR/../webera"
	local LOGFILE="$DIR/examples.log"
	local OUTPUT="$DIR/../docs"

	webera::generate-examples::parse-arguments "$@"

	webera::generate-examples::generate-all

	printf "\nDone.\n"

	if [ "$OPTION_LOAD_IN_WEB_BROWSER" = true ]; then
		$WEBERA -wO "$OUTPUT"
	fi

} #::main()


#-------------------------------------------------------------------------------
# ::display-usage
#
webera::generate-examples::display-usage() {

	cat <<- ENDwebera::generate-examples::display-usage

	Generates every example.

	webera::generate-examples::display-usage: ./generate-examples [OPTIONS]

	  -w              preview in web browser
	  -L <NUMBER>     log level [0=none|1|2|3] ($OPTION_LOG_LEVEL)
	  -c              switch clearing the log file (clear=$OPTION_CLEAR_LOG)
	ENDwebera::generate-examples::display-usage
	exit 1

} #::display-usage()


#-------------------------------------------------------------------------------
# ::parse-arguments
#
webera::generate-examples::parse-arguments() {
	local OPTIND OPTION
	while getopts 'wL:ch' OPTION; do

		case "$OPTION" in
			w) OPTION_LOAD_IN_WEB_BROWSER=true ;;
			L) OPTION_LOG_LEVEL="$OPTARG" ;;
			c) OPTION_LOG_CLEAR=true ;;
			h|*) webera::generate-examples::display-usage; exit ;;
		esac
	done

} #::parse-arguments()


#-------------------------------------------------------------------------------
# ::generate-all
#
webera::generate-examples::generate-all() {

	cd "$DIR" || exit

	[[ "$OPTION_LOG_CLEAR" == true ]] && rm -- "$LOGFILE" 2>/dev/null

	local EXAMPLES
	EXAMPLES=$(find . -maxdepth 1 -name "[0-9a-zA-Z]*" -type d \
		| cut -d'/' -f2 \
		| grep -v '^\.\+$' \
		| sort | tac | \
		tr '\n' ' ')

	for E in $EXAMPLES; do
		cd "$E" || exit

		printf 'generating '%s'. . . \n' "$E"

		"$WEBERA" -rt -L"${OPTION_LOG_LEVEL}" -G "$LOGFILE"

		cd "$DIR" || exit
	done

} #::generate-all()


[[ "$0" == "${BASH_SOURCE[0]}" ]] && webera::generate-examples::main "$@"
